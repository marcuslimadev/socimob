<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîç Debug Sistema - Status das Rotas</title>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-6xl mx-auto">
        <h1 class="text-3xl font-bold text-gray-800 mb-8">üîç Debug Sistema - Status das Rotas</h1>
        
        <!-- Status do Servidor -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-xl font-semibold text-blue-600 mb-4">üì° Status do Servidor</h2>
            <div id="server-status" class="mb-4">
                <div class="animate-pulse">Verificando servidor...</div>
            </div>
        </div>
        
        <!-- Teste de Rotas -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-xl font-semibold text-green-600 mb-4">üõ£Ô∏è Teste de Rotas</h2>
            <div class="mb-4">
                <button onclick="testarTodasRotas()" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
                    Testar Todas as Rotas
                </button>
                <button onclick="limparResultados()" class="bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded ml-2">
                    Limpar
                </button>
            </div>
            <div id="routes-results"></div>
        </div>
        
        <!-- Teste de API -->
        <div class="bg-white rounded-lg shadow-lg p-6">
            <h2 class="text-xl font-semibold text-purple-600 mb-4">üîß Teste Espec√≠fico - API Importa√ß√£o</h2>
            <div class="mb-4">
                <button onclick="testarImportacao()" class="bg-purple-500 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded">
                    Testar Importa√ß√£o de Im√≥veis
                </button>
            </div>
            <div id="import-results"></div>
        </div>
    </div>

    <script>
        const routes = [
            { method: 'GET', url: '/', name: 'Homepage' },
            { method: 'GET', url: '/api/health', name: 'Health Check' },
            { method: 'GET', url: '/app/', name: 'App Index' },
            { method: 'GET', url: '/app/index.html', name: 'App HTML' },
            { method: 'GET', url: '/app/dashboard.html', name: 'Dashboard' },
            { method: 'GET', url: '/app/imoveis.html', name: 'Im√≥veis' },
            { method: 'GET', url: '/app/login.html', name: 'Login' },
            { method: 'GET', url: '/portal/', name: 'Portal P√∫blico' },
            { method: 'GET', url: '/api/admin/settings', name: 'Admin Settings (requer auth)' }
        ];
        
        function verificarServidor() {
            $.get('/')
                .done(function() {
                    $('#server-status').html('<div class="flex items-center text-green-600"><span class="w-3 h-3 bg-green-500 rounded-full mr-2"></span>Servidor Online</div>');
                })
                .fail(function(xhr) {
                    $('#server-status').html('<div class="flex items-center text-red-600"><span class="w-3 h-3 bg-red-500 rounded-full mr-2"></span>Servidor Offline ou Erro</div>');
                });
        }
        
        function testarTodasRotas() {
            const resultsDiv = $('#routes-results');
            resultsDiv.html('<div class="animate-pulse">Testando rotas...</div>');
            
            let html = '<div class="space-y-2">';
            let completedTests = 0;
            
            routes.forEach(function(route, index) {
                $.ajax({
                    url: route.url,
                    method: route.method,
                    timeout: 5000
                })
                .done(function(data, textStatus, xhr) {
                    const statusClass = xhr.status === 200 ? 'text-green-600' : 'text-yellow-600';
                    html += `<div class="p-3 border rounded ${xhr.status === 200 ? 'border-green-200 bg-green-50' : 'border-yellow-200 bg-yellow-50'}">
                        <div class="flex justify-between items-center">
                            <span class="font-medium">${route.name}</span>
                            <span class="${statusClass}">‚úÖ ${xhr.status}</span>
                        </div>
                        <div class="text-sm text-gray-600">${route.method} ${route.url}</div>
                    </div>`;
                    
                    completedTests++;
                    if (completedTests === routes.length) {
                        html += '</div>';
                        resultsDiv.html(html);
                    }
                })
                .fail(function(xhr) {
                    let statusClass, icon, statusText;
                    
                    if (xhr.status === 404) {
                        statusClass = 'text-red-600';
                        icon = '‚ùå';
                        statusText = '404 Not Found';
                    } else if (xhr.status === 401) {
                        statusClass = 'text-orange-600';
                        icon = 'üîí';
                        statusText = '401 Unauthorized (esperado)';
                    } else if (xhr.status === 0) {
                        statusClass = 'text-gray-600';
                        icon = '‚ö†Ô∏è';
                        statusText = 'Sem conex√£o';
                    } else {
                        statusClass = 'text-red-600';
                        icon = '‚ùå';
                        statusText = `${xhr.status} Error`;
                    }
                    
                    const borderColor = xhr.status === 401 ? 'border-orange-200 bg-orange-50' : 'border-red-200 bg-red-50';
                    
                    html += `<div class="p-3 border rounded ${borderColor}">
                        <div class="flex justify-between items-center">
                            <span class="font-medium">${route.name}</span>
                            <span class="${statusClass}">${icon} ${statusText}</span>
                        </div>
                        <div class="text-sm text-gray-600">${route.method} ${route.url}</div>
                    </div>`;
                    
                    completedTests++;
                    if (completedTests === routes.length) {
                        html += '</div>';
                        resultsDiv.html(html);
                    }
                });
            });
        }
        
        function testarImportacao() {
            const resultsDiv = $('#import-results');
            resultsDiv.html('<div class="animate-pulse">Testando endpoint de importa√ß√£o...</div>');
            
            // Primeiro, tentar obter token (simulado)
            const fakeToken = 'dGVzdGUtdG9rZW4='; // base64 de "teste-token"
            
            $.ajax({
                url: '/api/admin/imoveis/importar',
                method: 'POST',
                headers: {
                    'Authorization': 'Bearer ' + fakeToken,
                    'Content-Type': 'application/json'
                },
                data: JSON.stringify({
                    fonte: 'exclusiva'
                }),
                timeout: 10000
            })
            .done(function(data, textStatus, xhr) {
                resultsDiv.html(`
                    <div class="p-4 border border-green-200 bg-green-50 rounded">
                        <div class="font-semibold text-green-800">‚úÖ Endpoint Funcionando</div>
                        <div class="text-sm text-gray-600 mt-2">Status: ${xhr.status}</div>
                        <div class="text-sm text-gray-600">Resposta: <pre class="mt-2 p-2 bg-gray-100 rounded text-xs">${JSON.stringify(data, null, 2)}</pre></div>
                    </div>
                `);
            })
            .fail(function(xhr) {
                let message, statusClass;
                
                if (xhr.status === 404) {
                    message = '‚ùå Rota de importa√ß√£o n√£o encontrada (Erro 404)';
                    statusClass = 'border-red-200 bg-red-50 text-red-800';
                } else if (xhr.status === 401) {
                    message = 'üîí Rota existe, mas requer autentica√ß√£o (OK - esperado)';
                    statusClass = 'border-orange-200 bg-orange-50 text-orange-800';
                } else if (xhr.status === 500) {
                    message = 'üî• Erro interno do servidor';
                    statusClass = 'border-red-200 bg-red-50 text-red-800';
                } else {
                    message = `‚ö†Ô∏è Status: ${xhr.status}`;
                    statusClass = 'border-yellow-200 bg-yellow-50 text-yellow-800';
                }
                
                resultsDiv.html(`
                    <div class="p-4 border ${statusClass} rounded">
                        <div class="font-semibold">${message}</div>
                        <div class="text-sm text-gray-600 mt-2">Status: ${xhr.status}</div>
                        <div class="text-sm text-gray-600">Resposta: ${xhr.responseText ? xhr.responseText.substring(0, 200) : 'Sem resposta'}</div>
                    </div>
                `);
            });
        }
        
        function limparResultados() {
            $('#routes-results').html('');
            $('#import-results').html('');
        }
        
        // Verificar servidor ao carregar a p√°gina
        $(document).ready(function() {
            verificarServidor();
        });
    </script>
</body>
</html>

